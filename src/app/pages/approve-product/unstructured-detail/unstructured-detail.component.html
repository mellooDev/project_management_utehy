<div class="card">
  <!-- Ti√™u ƒë·ªÅ trang -->
  <div class="card-header pt-3">
    <ul class="nav nav-tabs nav-line-tabs mb-5 fs-6">
      <li class="nav-item">
        <a class="nav-link active" data-bs-toggle="tab" href="#kt_tab_pane_1"
          >Th√¥ng tin s·∫£n ph·∫©m d·ªØ li·ªáu</a
        >
      </li>
      <li class="nav-item">
        <a class="nav-link" data-bs-toggle="tab" href="#kt_tab_pane_2"
          >ƒê√°nh gi√° t·ª´ ng∆∞·ªùi d√πng</a
        >
      </li>
    </ul>
  </div>

  <!-- B·ªô l·ªçc v√† n√∫t T·∫°o -->
  <div class="card-body pt-0">
    <div class="tab-content" id="myTabContent">
      <div class="tab-pane fade show active" id="kt_tab_pane_1" role="tabpanel">
        <div class=" mt-4">
          <div class="progress-container">

            <div class="stepper">
              <div class="stepData">
                <!-- Ti√™u ƒë·ªÅ ch√≠nh -->
                <div class="d-flex justify-content-between align-items-center">
                  <h2 class="">Th√¥ng tin chung</h2>
                  <div class="d-flex gap-3 align-items-center">
                    <h4 class="mb-0">Tr·∫°ng th√°i:
                    </h4>
                    <span>
                     @switch (approveStatus) {
                       @case(0) {
                         <span class="badge badge-warning">Ch·ªù ki·ªÉm duy·ªát</span>
                       }
                       @case(1) {
                         <span class="badge badge-success">ƒê√£ ki·ªÉm duy·ªát</span>
                       }
                       @case(2) {
                         <span class="badge badge-danger">T·ª´ ch·ªëi</span>
                       }
                       @case(4) {
                         <span class="badge badge-secondary">T·∫°m d·ª´ng</span>
                       }
                       @default {
                         <span class="badge badge-warning">Ch·ªù ki·ªÉm duy·ªát</span>
                       }
                     }
                    </span>
                  </div>
                </div>
                <div class="data-exchange-container">
                  <div class="row">
                    <!-- C·ªôt 8 -->
                    <div class="col-8">
                      <!-- D√≤ng 1 -->
                      <div class="form-row">
                        <div class="form-group col-6">
                          <label for="dataName">T√™n d·ªØ li·ªáu (*)</label>
                          <input type="text" id="dataName" class="form-control" [(ngModel)]="dataName"
                            (ngModelChange)="onInputChange('dataName')" placeholder="T√™n d·ªØ li·ªáu" required />
                          <span class="text-danger" *ngIf="isDataNameInvalid">
                            {{ messageStep2Name.dataName }}
                          </span>
                        </div>

                        <div class="form-group col-6">
                          <label for="dataField">Lƒ©nh v·ª±c(*)</label>
                          <select id="dataField" class="form-control" [(ngModel)]="dataField"
                            (ngModelChange)="onInputChange('dataField')">
                            <option value="" disabled selected class="placeholder">
                              Ch·ªçn lƒ©nh v·ª±c
                            </option>
                            <option *ngFor="let field of dataAPIField" [value]="field.description.category_description_id">
                              {{ field.description.name }}
                            </option>
                          </select>
                          <span *ngIf="isDataFieldInvalid" class="text-danger">
                            {{ messageStep2Name.dataField }}
                          </span>
                        </div>
                      </div>
                      <!-- D√≤ng 2 -->
                      <div class="form-row">
                        <div class="form-group col-6">
                          <label for="shortDescription">M√¥ t·∫£ ng·∫Øn (*)</label>
                          <input placeholder="Nh·∫≠p m√¥ t·∫£ ng·∫Øn" type="text" id="shortDescription" class="form-control"
                            [(ngModel)]="shortDescription" (ngModelChange)="onInputChange('shortDescription')" required />

                          <span class="text-danger" *ngIf="isShortDescriptionInvalid">
                            {{ messageStep2Name.shortDescription }}
                          </span>
                        </div>
                        <div class="form-group col-6">
                          <label>Logo</label>
                          <div class="image-upload-container">
                            <label for="logoUpload" class="upload-icon">
                              <i class="fa fa-upload" style="font-size: 25px"></i> T·∫£i
                              l√™n file
                            </label>
                            <input type="file" id="logoUpload" accept="image/png, image/jpeg" style="display: none"
                              (change)="onFileUpload($event)" />
                          </div>
                          <!-- <label for="logoUpload">Logo t·∫£i l√™n</label>
                      <input type="file" id="logoUpload" class="form-control" (change)="onFileUpload($event)" /> -->
                        </div>
                      </div>
                      <!-- D√≤ng 3 -->
                      <div class="form-row">
                        <div class="form-group col-12">
                          <label for="dataDescription">M√¥ t·∫£ d·ªØ li·ªáu(*)</label>
                          <angular-editor [(ngModel)]="htmlContentDes" [config]="editorConfig" [(ngModel)]="longDescription"
                            (ngModelChange)="onInputChange('longDescription')"></angular-editor>
                          <span class="text-danger" *ngIf="isLongDescriptionInvalid">
                            {{ messageStep2Name.longDescription }}
                          </span>
                        </div>
                      </div>
                    </div>

                    <!-- C·ªôt 4 -->
                    <div class="col-4">
                      <!-- D√≤ng 1 -->
                      <div class="form-group">
                        <label for="version">Phi√™n b·∫£n (*)</label>
                        <input placeholder="Nh·∫≠p phi√™n b·∫£n, v√≠ d·ª•: 1.1.1" type="text" id="version" class="form-control"
                          [(ngModel)]="version" (ngModelChange)="onInputChange('version')" required readonly />
                        <span class="text-danger" *ngIf="isVersionInvalid">
                          {{ messageStep2Name.version }}
                        </span>
                      </div>
                      <!-- D√≤ng 2 -->
                      <div class="form-group">
                        <label class="mt-6">Hi·ªÉn th·ªã</label>
                        <div class="data-check mt-3">
                          <input type="radio" id="displayYes" value="hi·ªÉn th·ªã" [(ngModel)]="displayOption"
                            [checked]="displayOption === 'hi·ªÉn th·ªã'" />
                          <label for="displayYes">Hi·ªÉn th·ªã</label>
                          <input type="radio" id="displayNo" value="·∫©n" [(ngModel)]="displayOption"
                            [checked]="displayOption === '·∫©n'" />
                          <label for="displayNo">·∫®n</label>
                        </div>
                      </div>

                      <!-- D√≤ng 3 -->
                      <div class="form-group2">
                        <label class="mt-6">S·ªü h·ªØu d·ªØ li·ªáu</label>
                        <div class="data-check mt-3">
                          <input type="radio" id="ownerManager" value="Ch·ªß qu·∫£n" [(ngModel)]="ownershipOption"
                            [checked]="ownershipOption === 'Ch·ªß qu·∫£n'" />
                          <label for="ownerManager">Ch·ªß qu·∫£n</label>
                          <input type="radio" id="ownerHolder" value="Ch·ªß s·ªü h·ªØu" [(ngModel)]="ownershipOption"
                            [checked]="ownershipOption === 'Ch·ªß s·ªü h·ªØu'" />
                          <label for="ownerHolder">Ch·ªß s·ªü h·ªØu</label>
                        </div>
                      </div>

                    </div>
                  </div>
                </div>
              </div>
              <div class="stepData">
                <!-- Ti√™u ƒë·ªÅ ch√≠nh -->
                <h2 class="">T√†i li·ªáu</h2>
                <div class="data-exchange-container">
                  <div class="row">
                    <!-- C·ªôt 8 -->
                    <div class="col-8">
                      <div class="form-row">
                        <div class="form-group col-12">
                          <label for="dataDescription">·ª®ng d·ª•ng c·ªßa d·ªØ li·ªáu</label>
                          <angular-editor [(ngModel)]="htmlContentApp" [config]="editorConfig"></angular-editor>
                        </div>
                      </div>
                      <div class="form-row">
                        <div class="form-group col-12">
                          <label for="dataDescription">V√≠ d·ª• s·ª≠ d·ª•ng</label>
                          <angular-editor [(ngModel)]="htmlContentExample" [config]="editorConfig"></angular-editor>
                        </div>
                      </div>
                    </div>

                    <!-- C·ªôt 4 -->
                    <div class="col-4">
                      <!-- D√≤ng 1 -->
                      <div class="form-group">
                        <label>D·ªØ li·ªáu m·∫´u</label>
                        <div class="image-upload-container">
                          <label for="imageUpload" class="upload-icon">
                            <i class="fa fa-upload" style="font-size: 25px"></i> T·∫£i l√™n
                            file
                          </label>
                          <input type="file" id="imageUpload" accept="image/png, image/jpeg" style="display: none"
                            (change)="onImageUpload($event, selectedImageIndex)" />

                          <div class="uploaded-images">
                            <div *ngFor="let image of uploadedImages; index as i" class="image-frame"
                              [class.selected]="selectedImageIndex === i" (click)="selectedImageIndex = i">
                              <img [src]="image" alt="Uploaded Image" />
                            </div>
                          </div>
                        </div>
                      </div>

                      <!-- D√≤ng 2 -->
                      <div class="form-group">
                        <label class="mt-6">Ch·ª©ng ch·ªâ d·ªØ li·ªáu</label>
                        <div class="pdf-upload-container">
                          <label for="pdfUpload" class="upload-icon">
                            <i class="fa fa-upload" style="font-size: 25px"></i> T·∫£i l√™n
                            file
                          </label>
                          <input type="file" id="pdfUpload" accept="application/pdf" style="display: none"
                            (change)="onPdfUpload($event)" />

                          <div class="uploaded-pdfs">
                            <div *ngFor="let pdf of uploadedPdfs; index as i" class="pdf-item">
                              <a [href]="pdf.url" target="_blank">{{ pdf.name }}</a>
                              <button class="delete-btn" (click)="removePdf(i, pdf.url)">
                                X
                              </button>
                            </div>
                          </div>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
              </div>

              <div class="stepData">
                <!-- Ti√™u ƒë·ªÅ ch√≠nh -->
                <h2 class="">Chi ph√≠</h2>
                <div class="data-selection-container">
                  <div style="display: flex; gap: 15px">
                    <div class="payment-action">
                      <div class="payment-option" [ngClass]="{ selected: isPlanSelected === 'free' }"
                        (click)="selectPayment('free')">
                        <span class="icon">üÜì</span>
                        <span class="text">Mi·ªÖn ph√≠</span>
                        <span *ngIf="isPlanSelected === 'free'" class="checkmark">‚úî</span>
                      </div>

                      <div class="payment-option" [ngClass]="{ selected: isPlanSelected === 'paid' }"
                        (click)="selectPayment('paid')">
                        <span class="icon">üíµ</span>
                        <span class="text">Tr·∫£ ph√≠</span>
                        <span *ngIf="isPlanSelected === 'paid'" class="checkmark">‚úî</span>
                      </div>
                    </div>
                    <div class="payment-content-right">
                      <div *ngIf="isPlanSelected === 'free'" class="notification">
                        <div class="free-payment-notification">
                          <p>D·ªØ li·ªáu ƒë∆∞·ª£c chia s·∫ª kh√¥ng t√≠nh ph√≠</p>
                          <p>
                            B·∫•t k√¨ c√° nh√¢n/ t·ªï ch·ª©c/ ng∆∞·ªùi s·ª≠ d·ª•ng d·ªØ li·ªáu ƒë·ªÅu c√≥ th·ªÉ
                            truy c·∫≠p v√† s·ª≠ d·ª•ng d·ªØ li·ªáu
                          </p>
                        </div>
                      </div>
                      <div *ngIf="isPlanSelected === 'paid'" class="payment-content">
                        <table class="table table-striped custom-bordered">
                          <thead class="custom-header">
                            <tr>
                              <th>T√™n g√≥i c∆∞·ªõc</th>
                              <th>Lo·∫°i g√≥i</th>
                              <th>ƒê∆°n gi√°</th>
                              <th>ƒê∆°n v·ªã</th>
                            </tr>
                          </thead>
                          <tbody>
                            <tr *ngFor="let item of planList; let i = index">
                              <td>{{ item.planName }}</td>
                              <td>
                                @switch (item.planType) {
                                  @case('REQUEST') {
                                    <span>Thanh to√°n theo l∆∞·ª£t request</span>
                                  }
                                  @case('DURATION') {
                                    <span>Thanh to√°n theo chu k·ª≥</span>
                                  }
                                  @case('FULLPURCHASE') {
                                    <span>Thanh to√°n to√†n b·ªô</span>
                                  }
                                  @case('PAYPERUSE') {
                                    <span>Thanh to√°n 1 l∆∞·ª£t</span>
                                  }
                                  @default {
                                    <span>Kh√¥ng x√°c ƒë·ªãnh</span>
                                  }
                                }
                              </td>
                              <td>{{ item.basePrice }}</td>
                              <td>{{ item.optionMount }}</td>
                            </tr>
                          </tbody>
                        </table>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
              <div class="stepData">
                <!-- Ti√™u ƒë·ªÅ ch√≠nh -->
                <h2 class="">Ch·ªçn d·ªØ li·ªáu</h2>
                <div class="data-selection-container">
                  <!-- Khu v·ª±c t·∫£i file -->
                  <div class="upload-section">
                    <label for="file-upload" class="upload-title">
                      <i class="fa fa-upload"></i>
                    </label>
                    <input type="file" id="file-upload" class="file-input" accept=".csv,.json,.xml,.xlsx"
                      (change)="onDataUpload($event)" />
                  </div>
                  <label> T·∫£i d·ªØ li·ªáu l√™n (csv/json/xml/xlsx) </label>
                </div>
                <div class="data-exchange-container">
                  <div class="data-lists">
                    <!-- Danh s√°ch b√™n tr√°i -->
                    <div class="list-container">
                      <h4 class="list-title">D·ªØ li·ªáu ƒë√£ t·∫£i l√™n</h4>
                      <ul class="data-list">
                        <li *ngFor="let item of dataFiles" style="text-align: left">
                          <label>
                            <input type="checkbox" [checked]="selectedLeftItems.includes(item)"
                              (change)="toggleSelection(item, 'left')" />
                            {{ item.fileName }}
                          </label>
                        </li>
                      </ul>
                    </div>

                    <!-- N√∫t ƒëi·ªÅu khi·ªÉn -->
                    <div class="controlsData">
                      <button class="control-btn" (click)="moveToRight()">&gt;</button>
                      <button class="control-btn" (click)="moveToLeft()">&lt;</button>
                    </div>

                    <!-- Danh s√°ch b√™n ph·∫£i -->
                    <div class="list-container">
                      <h4 class="list-title">D·ªØ li·ªáu ƒë√£ ch·ªçn</h4>
                      <ul class="data-list">
                        <li *ngFor="let item of selectedDataDone" style="text-align: left">
                          <label>
                            <input type="checkbox" [checked]="selectedRightItems.includes(item)"
                              (change)="toggleSelection(item, 'right')" />
                            {{ item?.fileName }}
                          </label>
                        </li>
                      </ul>
                      <span class="text-danger">{{ messageStep1File }}</span>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>

          <div class="d-flex justify-content-center gap-4" *ngIf="approveStatus === 0">
            <button class="btn btn-primary" (click)="openRefuseProdModal(acceptedProduct)">ƒê·ªìng √Ω</button>
            <button class="btn btn-danger" (click)="openRefuseProdModal(refuseProduct)">T·ª´ ch·ªëi</button>
          </div>

          <!-- <div class="controls container mt-5 d-flex ">
            <button class="btn btn-inline btn-sm btn-primary pull-right" style="margin-left: auto; margin-right: 0;" (click)="nextStep()">L∆∞u</button>
          </div> -->
        </div>

      </div>

      <div class="tab-pane fade" id="kt_tab_pane_2" role="tabpanel">
        <div class="d-flex justify-content-between align-items-center mt-4">
          <h3>Danh s√°ch c√°c ƒë√°nh gi√°</h3>
          <div class="d-flex gap-3 align-items-center">
            <div ngbDropdown class="d-inline-block">
              <button type="button" class="btn-secondary button-action" id="dropdownBasic1" ngbDropdownToggle>
                Tr·∫°ng th√°i
              </button>
              <div ngbDropdownMenu aria-labelledby="dropdownBasic1">
                <button ngbDropdownItem (click)="loadRating(0)">·∫®n</button>
                <button ngbDropdownItem (click)="loadRating(1)">Hi·ªán</button>
              </div>
            </div>

            <div ngbDropdown class="d-inline-block">
              <button type="button" class="btn-secondary button-action" id="dropdownBasic2" ngbDropdownToggle>
                S·∫Øp x·∫øp theo
              </button>
              <div ngbDropdownMenu aria-labelledby="dropdownBasic2">
                <button ngbDropdownItem (click)="sortRating(1)">M·ªõi nh·∫•t</button>
                <button ngbDropdownItem (click)="sortRating(2)">C≈© nh·∫•t</button>
              </div>
            </div>
          </div>

        </div>

        <!-- button filter by star number -->
         <div class="d-flex gap-3 align-items-center" style="margin-top: 10px;">
          <button
            *ngFor="let btn of buttonRatingArray; let i = index"
            (click)="setActiveButtonRating(i)"
            class="btn-primary button-filter-rating"
            [ngClass]="{'active': selectedButtonFilter === i}"
          >

            {{ btn.label }}
            <span *ngIf="btn.count !== null">({{ btn.count }})</span>

          </button>

         </div>

         <!-- rating content block -->

         <div *ngIf="ratingDatas.length === 0; else dataAvailable" class="mt-5">
          Ch∆∞a c√≥ ƒë√°nh gi√° n√†o v·ªÅ s·∫£n ph·∫©m.
          </div>

          <ng-template #dataAvailable>
            <div *ngFor="let rating of ratingDatas">
              <div style="margin-top: 30px;">
                <!-- header -->
                <div class="d-flex align-items-center justify-content-between">
                  <div class="d-flex align-items-center gap-4">
                    <div class="avatar">
                      <img [src]="rating.image ? 'data: image/jpeg;base64,' + rating.image : defaultImage" width="35" height="35" class="" style="object-fit: contain; object-position: center; border-radius: 50%;" alt="">
                    </div>
                    <span style="font-weight: bold;">{{ rating.fullName }}</span>
                    <span>‚Ä¢</span>
                    <span>{{ rating.createAt | date:'dd-MM-yyyy HH:mm:ss' }}</span>
                  </div>

                  <ngb-rating [rate]="rating.rate"  >
                    <ng-template let-fill="fill">
                      <span class="custom-star" [class.filled]="fill === 100">‚òÖ</span>
                    </ng-template>
                  </ngb-rating>
                </div>

                <!-- content -->
                 <span style="padding: 15px 0 25px; display: inline-block; line-height: 1.6;">{{ rating.content }}</span>

                 <div class="d-flex justify-content-end align-items-center gap-5">
                    <i class="bi" [ngClass]="{
                      'bi-eye-slash': rating.isShow === '0',
                      'bi-eye': rating.isShow !== '0'
                    }" style="font-size: 1.3rem; cursor: pointer;" (click)="toggleComment(toggleRatingModal, rating.id, rating.isShow === '0', rating)"></i>
                    <i class="bi bi-trash3" style="font-size: 1.3rem; cursor: pointer;"></i>
                 </div>

                 <hr style="border: none; border-top: 2px solid #000;">
              </div>
            </div>
          </ng-template>



        <!-- pagination -->
        <div *ngIf="ratingDatas.length > 0" class="pagination-container d-flex justify-content-end mt-3">
          <ngb-pagination
            [collectionSize]="recordsTotal"
            [(page)]="currentPage"
            [pageSize]="pageSize"
            (pageChange)="onPageChange($event)"
          ></ngb-pagination>
        </div>
      </div>
    </div>
  </div>
</div>

<ng-template let-modal #acceptedProduct>
  <div class="modal-header">
    <h4 class="modal-title" id="modal-basic-title">X√°c nh·∫≠n ƒë·ªìng √Ω ph√™ duy·ªát</h4>
  </div>

  <div class="modal-body text-center">
    <p>B·∫°n c√≥ ch·∫Øc ch·∫Øn ƒë·ªìng √Ω ph√™ duy·ªát d·ªØ li·ªáu kh√¥ng?</p>
  </div>

  <div class="modal-footer">
    <p-toast />
    <button class="btn btn-primary" (click)="onAcceptProd()">
      <span *ngIf="!isLoading">X√°c nh·∫≠n</span>
      <span *ngIf="isLoading" class="spinner-border spinner-border-sm" role="status" aria-hidden="true"></span>
    </button>
    <button class="btn btn-secondary" (click)="closeModal()">ƒê√≥ng</button>
  </div>
</ng-template>

<ng-template let-modal #refuseProduct>
  <div class="modal-header">
    <h4 class="modal-title" id="modal-basic-title">X√°c nh·∫≠n t·ª´ ch·ªëi ph√™ duy·ªát</h4>
  </div>

  <div class="modal-body">
    <div class="form-group mb-4">
      <label for="templateSubject" class="mb-2">L√Ω do t·ª´ ch·ªëi</label>
      <select class="form-control form-select select-method" [(ngModel)]="selectedReason">
        <option value="" selected disabled hidden>Ch·ªçn lo·∫°i l√Ω do</option>
        <option *ngFor="let item of rejectReasons" [value]="item.name">{{item.name}}</option>
        <option value="other">Kh√°c</option>
        <!-- <option *ngFor="let template of emailTemplatesCodes" [value]="template.code">{{template.name}}</option> -->
      </select>
    </div>

    <div class="form-group mb-3 w-100" *ngIf="selectedReason === 'other'">
      <label for="templateName" class="mb-2">Nh·∫≠p l√Ω do</label>
      <textarea class="form-control" id="reason" [(ngModel)]="customReason" required rows="3"></textarea>
    </div>
  </div>

  <div class="modal-footer">
    <p-toast />
    <button class="btn btn-primary" (click)="onRefuseProd()">
      <span *ngIf="!isLoading">X√°c nh·∫≠n</span>
      <span *ngIf="isLoading" class="spinner-border spinner-border-sm" role="status" aria-hidden="true"></span>
    </button>
    <button class="btn btn-secondary" (click)="closeModal()">ƒê√≥ng</button>
  </div>
</ng-template>

<ng-template let-modal #toggleRatingModal>
  <form #myForm="ngForm" (ngSubmit)="onHideOrUnhide($event, myForm)">
    <div class="modal-header">
      <h4 class="modal-title" id="modal-basic-title">
        {{ pendingValue ? 'Hi·ªÉn th·ªã' : '·∫®n' }} ƒë√°nh gi√°
      </h4>
    </div>

    <div class="modal-body">
      <div>
        <span>B·∫°n c√≥ ch·∫Øc ch·∫Øn mu·ªën {{ pendingValue ? 'hi·ªÉn th·ªã' : '·∫©n' }} ƒëi ƒë√°nh gi√° t·ª´ ng∆∞·ªùi d√πng {{ selectedRatingOwner }} kh√¥ng?</span>
      </div>
    </div>

    <div class="modal-footer">
      <button
        class="btn btn-secondary"
        type="button"
        (click)="closeModal()"
      >
        H·ªßy b·ªè
      </button>
      <button type="submit" class="btn btn-primary" [disabled]="isLoading">
        <span *ngIf="!isLoading">{{ pendingValue ? 'Hi·ªÉn th·ªã' : '·∫®n' }}</span>
        <span *ngIf="isLoading" class="spinner-border spinner-border-sm" role="status" aria-hidden="true"></span>
      </button>
    </div>
  </form>
</ng-template>
